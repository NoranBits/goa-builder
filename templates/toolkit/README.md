# .toolkit

## Purpose

`.toolkit/**` is the repo-agnostic tool surface generated by `.builder`.

It is designed for:

- Fast repo understanding (scan/search)
- Repeatable validation (lint/typecheck/format/markdown)
- Safe build/test automation
- Structured logs for debugging and audit

It is designed to be safe-by-default and easy for agents (and humans) to extend.

## Layout

- `scan/`: discover what this repo is and where key entry points live.
- `search/`: fast code search helpers (grep/rg wrappers, symbol maps, etc.).
- `validate/`: lint/typecheck/markdown gates and policy checks.
- `test/`: smallest-relevant test runners and focused repro tools.
- `log/`: log collection, normalization, and analysis helpers.
- `build/`: build pipelines and packaging prerequisites.
- `install/`: bootstrap scripts for dependencies and dev env.
- `package/`: bundle artifacts for release or deployment.
- `update/`: maintenance tasks (deps, lockfiles, snapshots).

Each category has a `README.md` defining its contract.

## Layering model

Treat `.toolkit/**` as three layers:

1. **Contracts**: `README.md` in each category defines what “good” looks like.
2. **Stable tools**: promoted scripts that are safe, documented, and used often.
3. **Experimental tools**: `custom-tools/` prototypes and one-offs.

## Composition (prefer fewer, stronger tools)

Agents should not need to run 6 commands in a row to get a reliable outcome.

Design tools to be composable, then create a small set of “composite tools” that
bundle the common sequences.

Good composites:

- `quality_gate`: `validate` + fast `test` + markdown policy.
- `triage_bug`: `scan` + `search` + `log` bundle + minimal repro.
- `prepare_release`: `build` + `package` + integrity checks.

## When to combine vs split

Combine steps into one tool when:

- They are always run together.
- The order is deterministic.
- Shared context (targets, excludes, env) reduces repeated mistakes.

Keep steps separate when:

- They are useful in isolation.
- They are expensive or slow.
- You need different inputs or outputs per run.

## Custom tools and promotion

Every category contains `custom-tools/`.

- Put experiments and repo-specific helpers in `custom-tools/` first.
- Promote a tool into the category root only after explicit confirmation.

Promotion checklist:

1. The tool is idempotent (safe to re-run).
2. It has a `--help` and clear exit codes.
3. It defaults to read-only mode unless a write flag is explicit.
4. It writes logs under `.logs/` (gitignored) when it produces large output.
5. It documents inputs, outputs, and failure modes.

## Logging conventions

- Runtime outputs belong in `.logs/` (gitignored).
- Append-only audit logs belong in `.logs/**` (tracked).

## Safety rules

- Never write outside the repo root.
- Never modify files unless a write mode is explicit.
- Always fail fast on missing prerequisites.
- Prefer standard library and minimal dependencies.
