# Telemetry & Logging Standards

**Status**: Authoritative Standard (Builder V3)
**Scope**: All repositories (Language/Framework Agnostic)

## 1. The Unified Log Philosophy

We do not dictate *how* your application logs (library, format, transport).
We strictly dictate *where* those logs must land to be actionable by Agents and Analytics pipelines.

**Rule Zero**: All runtime artifacts, telemetry, and session logs must settle into the `.logs/` root directory.

## 2. Directory Structure (The "Spine")

Agents and Builders must enforce this structure. Do not create custom root-level log folders.

| Directory | Domain | Definition | Retention |
| :--- | :--- | :--- | :--- |
| `.logs/ai/` | **Intelligence** | Prompts, completions, thoughts, and agent decisions. | Ephemeral (Session) |
| `.logs/service/` | **Infrastructure** | Stdout/Stderr from daemons, databases, servers, containers. | Ephemeral (Session) |
| `.logs/session/` | **Human Context** | Markdown summaries of developer sessions (auto-generated). | Ephemeral (Session) |
| `.logs/test/` | **Quality Assurance** | Test reports (JSON/XML), coverage (LCOV), benchmarks. | Ephemeral (Run) |
| `.logs/tool/` | **Operations** | build scripts, linters, migrations, deploy logs. | Ephemeral (Run) |
| `.logs/client/` | **Application** | Client-side logs (Game Engine, Browser, Mobile App). | Ephemeral (Session) |
| `.logs/changes/` | **Audit** | File modification history (Golden Record). | **Permanent (Git)** |
| `.logs/navigation/` | **Audit** | Developer movement traversal history. | **Permanent (Git)** |

## 3. Integration Guidelines (For Agents & Builders)

When integrating a new component (Unity Game, Rust API, Python Script), follow this protocol:

### Step 1: Discovery (Don't Assume)

- **Scan** the codebase for existing logging patterns (`println`, `console.log`, `logging.info`).
- **Identify** the entry point (e.g., `main.ts`, `Start()`, `__main__`).
- **Determine** the configuration method (Env vars, Config file, Code injection).

### Step 2: Injection (The pipeline)

Route the output to the appropriate `.logs/` subdirectory.

#### Strategies:

1.  **Transport Configuration** (Best): Configure the logger to write to file.
    *   *Example (Python)*: `logging.FileHandler('.logs/service/api.log')`
    *   *Example (Node)*: `winston.transports.File({ filename: '.logs/service/api.log' })`
2.  **Output Redirection** (Universal): Pipe stdout/stderr in the runner script.
    *   *Example (Shell)*: `./game-server > .logs/service/game-server.log 2>&1`
3.  **Reporter Flags** (Testing): Use CLI args to dump structured data.
    *   *Example (Vitest)*: `--reporter=json --outputFile=.logs/test/coverage/results.json`
    *   *Example (Playwright)*: `--reporter=html:outputFolder=.logs/test/e2e/report`

### Step 3: Contextualization

Ensure logs include timestamps and component names where possible.

- **Good**: `[2026-01-11T12:00:00Z] [PhysicsEngine] Collision detected`
- **Bad**: `Collision detected`

## 4. Multi-Language Examples

This standard applies to **all** technologies.

### Unity (C#)

```csharp
// Attach to the application log loop
void Awake() {
    string logPath = Path.Combine(Directory.GetParent(Application.dataPath).ToString(), ".logs/client/game.log");
    Application.logMessageReceived += (logString, stackTrace, type) => {
        File.AppendAllText(logPath, $"[{DateTime.Now}] [{type}] {logString}\n");
    };
}
```

### Rust

```rust
// Use a file appender
let file = File::create(".logs/service/rust-backend.log")?;
env_logger::Builder::new()
    .target(env_logger::Target::Pipe(Box::new(file)))
    .init();
```

### Unreal Engine (C++)

*Use a custom output device or launch argument:*
`-LogCmds="LogFile .logs/client/unreal.log"` (Requires path resolution handling)

## 5. Analytics & Parsing

Analytics Agents will consume `.logs/**` using specific patterns:

- **Extensions**: `.json` (strict parse), `.log` (line grep), `.md` (header extraction).
- **Errors**: automated grep for `[ERROR]`, `Exception`, `Panic`, `Crash`.
- **Metrics**: automated extraction of `Coverage: X%`, `Tests: Y/Z passed`.

---
*Generated by Builder V3. Maintain this standard to ensure observability across the entire project ecosystem.*
